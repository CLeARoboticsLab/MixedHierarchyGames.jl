<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API Reference · MixedHierarchyGames.jl</title><meta name="title" content="API Reference · MixedHierarchyGames.jl"/><meta property="og:title" content="API Reference · MixedHierarchyGames.jl"/><meta property="twitter:title" content="API Reference · MixedHierarchyGames.jl"/><meta name="description" content="Documentation for MixedHierarchyGames.jl."/><meta property="og:description" content="Documentation for MixedHierarchyGames.jl."/><meta property="twitter:description" content="Documentation for MixedHierarchyGames.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MixedHierarchyGames.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>API Reference</a><ul class="internal"><li><a class="tocitem" href="#Module"><span>Module</span></a></li><li><a class="tocitem" href="#Types"><span>Types</span></a></li><li><a class="tocitem" href="#Solvers"><span>Solvers</span></a></li><li><a class="tocitem" href="#Solver-Helpers"><span>Solver Helpers</span></a></li><li><a class="tocitem" href="#Linesearch-Methods"><span>Linesearch Methods</span></a></li><li><a class="tocitem" href="#KKT-Construction"><span>KKT Construction</span></a></li><li><a class="tocitem" href="#Problem-Setup"><span>Problem Setup</span></a></li><li><a class="tocitem" href="#Graph-Utilities"><span>Graph Utilities</span></a></li><li><a class="tocitem" href="#Internal-Functions"><span>Internal Functions</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API Reference</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/main/docs/src/api.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h1><h2 id="Module"><a class="docs-heading-anchor" href="#Module">Module</a><a id="Module-1"></a><a class="docs-heading-anchor-permalink" href="#Module" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="MixedHierarchyGames"><a class="docstring-binding" href="#MixedHierarchyGames"><code>MixedHierarchyGames</code></a> — <span class="docstring-category">Module</span></summary><section><div><pre><code class="language-julia hljs">MixedHierarchyGames</code></pre><p>A Julia package for solving mixed hierarchy (Stackelberg) trajectory games.</p><p>Provides two solvers:</p><ul><li><code>QPSolver</code> - For quadratic programming problems with linear dynamics</li><li><code>NonlinearSolver</code> - For general nonlinear problems</li></ul><p>Both solvers implement the <code>TrajectoryGamesBase.solve_trajectory_game!</code> interface.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/MixedHierarchyGames.jl#L1-L11">source</a></section></details></article><h2 id="Types"><a class="docs-heading-anchor" href="#Types">Types</a><a id="Types-1"></a><a class="docs-heading-anchor-permalink" href="#Types" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.QPSolver"><a class="docstring-binding" href="#MixedHierarchyGames.QPSolver"><code>MixedHierarchyGames.QPSolver</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">QPSolver</code></pre><p>Solver for quadratic programming hierarchy games (linear dynamics, quadratic costs).</p><p><strong>Fields</strong></p><ul><li><code>problem::HierarchyProblem</code> - The problem specification</li><li><code>solver_type::Symbol</code> - Solver backend (:linear or :path)</li><li><code>precomputed::QPPrecomputed</code> - Precomputed symbolic components (variables, KKT conditions)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/types.jl#L77-L86">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.NonlinearSolver"><a class="docstring-binding" href="#MixedHierarchyGames.NonlinearSolver"><code>MixedHierarchyGames.NonlinearSolver</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">NonlinearSolver</code></pre><p>Solver for general nonlinear hierarchy games.</p><p>Uses iterative quasi-linear policy approximation with configurable line search.</p><p><strong>Fields</strong></p><ul><li><code>problem::HierarchyProblem</code> - The problem specification</li><li><code>precomputed::NamedTuple</code> - Precomputed symbolic components from preoptimize<em>nonlinear</em>solver</li><li><code>options::NamedTuple</code> - Solver options (max<em>iters, tol, verbose, linesearch</em>method, recompute<em>policy</em>in<em>linesearch, use</em>sparse)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/types.jl#L317-L328">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.HierarchyGame"><a class="docstring-binding" href="#MixedHierarchyGames.HierarchyGame"><code>MixedHierarchyGames.HierarchyGame</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">HierarchyGame</code></pre><p>A trajectory game with hierarchical (Stackelberg) structure.</p><p><strong>Fields</strong></p><ul><li><code>game::TrajectoryGame</code> - The underlying trajectory game</li><li><code>hierarchy_graph::SimpleDiGraph</code> - DAG representing leader-follower relationships (edge i→j means player i is a leader of player j)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/types.jl#L5-L14">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.HierarchyProblem"><a class="docstring-binding" href="#MixedHierarchyGames.HierarchyProblem"><code>MixedHierarchyGames.HierarchyProblem</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">HierarchyProblem</code></pre><p>Low-level problem specification for hierarchy games. Stores cost functions, constraints, and symbolic variables. Used by both QPSolver and NonlinearSolver.</p><p><strong>Fields</strong></p><ul><li><code>hierarchy_graph::SimpleDiGraph</code> - DAG of leader-follower relationships</li><li><code>Js::Dict</code> - Cost functions per player: Js<a href="zs...; θ">i</a> → scalar</li><li><code>gs::Vector</code> - Constraint functions per player: gs<a href="z">i</a> → Vector</li><li><code>primal_dims::Vector{Int}</code> - Decision variable dimension per player</li><li><code>θs::Dict</code> - Symbolic parameter variables per player</li><li><code>state_dim::Int</code> - State dimension per player (for trajectory extraction)</li><li><code>control_dim::Int</code> - Control dimension per player (for trajectory extraction)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/types.jl#L20-L35">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.QPPrecomputed"><a class="docstring-binding" href="#MixedHierarchyGames.QPPrecomputed"><code>MixedHierarchyGames.QPPrecomputed</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">QPPrecomputed</code></pre><p>Precomputed components for QPSolver, cached during construction for efficient repeated solves.</p><p><strong>Type Parameters</strong></p><ul><li><code>TV</code> - Type of problem variables (from setup<em>problem</em>variables)</li><li><code>TK</code> - Type of KKT conditions result (from get<em>qp</em>kkt_conditions)</li><li><code>TP&lt;:AbstractDict</code> - Type of stripped policy constraints (Dict)</li><li><code>TM</code> - Type of parametric MCP (ParametricMCP)</li><li><code>TJ</code> - Type of Jacobian buffer (sparse or dense matrix)</li></ul><p><strong>Fields</strong></p><ul><li><code>vars::TV</code> - Problem variables from setup<em>problem</em>variables</li><li><code>kkt_result::TK</code> - KKT conditions from get<em>qp</em>kkt_conditions</li><li><code>πs_solve::TP</code> - Stripped policy constraints for solving</li><li><code>parametric_mcp::TM</code> - Cached ParametricMCP for solving</li><li><code>J_buffer::TJ</code> - Pre-allocated Jacobian buffer for solve<em>qp</em>linear</li><li><code>F_buffer::Vector{Float64}</code> - Pre-allocated residual buffer for solve<em>qp</em>linear</li><li><code>z0_buffer::Vector{Float64}</code> - Pre-allocated zero vector for solve<em>qp</em>linear</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/types.jl#L46-L66">source</a></section></details></article><h2 id="Solvers"><a class="docs-heading-anchor" href="#Solvers">Solvers</a><a id="Solvers-1"></a><a class="docs-heading-anchor-permalink" href="#Solvers" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.solve"><a class="docstring-binding" href="#MixedHierarchyGames.solve"><code>MixedHierarchyGames.solve</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">solve(solver::QPSolver, parameter_values::Dict; kwargs...)</code></pre><p>Solve the QP hierarchy game with given parameter values (typically initial states).</p><p>Uses precomputed symbolic KKT conditions for efficiency.</p><p><strong>Arguments</strong></p><ul><li><code>solver::QPSolver</code> - The QP solver with precomputed components</li><li><code>parameter_values::Dict</code> - Numerical values for parameters (e.g., initial states per player)</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>verbose::Bool=false</code> - Print debug info</li><li><code>iteration_limit::Int=100000</code> - Maximum iterations for PATH solver (only used with :path)</li><li><code>proximal_perturbation::Float64=1e-2</code> - Proximal perturbation parameter (only used with :path)</li><li><code>use_basics::Bool=true</code> - Use basic solution from PATH (only used with :path)</li><li><code>use_start::Bool=true</code> - Use starting point from PATH (only used with :path)</li></ul><p><strong>Returns</strong></p><ul><li><code>JointStrategy</code> containing <code>OpenLoopStrategy</code> for each player</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L23-L43">source</a></section><section><div><pre><code class="language-julia hljs">solve(solver::NonlinearSolver, parameter_values::Dict; kwargs...)</code></pre><p>Solve the nonlinear hierarchy game with given parameter values (typically initial states).</p><p>Uses precomputed symbolic components for efficiency.</p><p><strong>Arguments</strong></p><ul><li><code>solver::NonlinearSolver</code> - The nonlinear solver with precomputed components</li><li><code>parameter_values::Dict</code> - Numerical values for parameters (e.g., initial states per player)</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>initial_guess::Union{Nothing, Vector}=nothing</code> - Warm start for the solver</li><li><code>show_progress::Union{Nothing, Bool}=nothing</code> - Display iteration progress table</li><li>Additional options override solver.options</li></ul><p><strong>Returns</strong></p><ul><li><code>JointStrategy</code> containing <code>OpenLoopStrategy</code> for each player</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L175-L193">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.solve_raw"><a class="docstring-binding" href="#MixedHierarchyGames.solve_raw"><code>MixedHierarchyGames.solve_raw</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">solve_raw(solver::QPSolver, parameter_values::Dict; kwargs...)</code></pre><p>Solve and return raw solution vector (for debugging/analysis).</p><p><strong>Keyword Arguments</strong></p><ul><li><code>verbose::Bool=false</code> - Print debug info</li><li><code>iteration_limit::Int=100000</code> - Maximum iterations for PATH solver (only used with :path)</li><li><code>proximal_perturbation::Float64=1e-2</code> - Proximal perturbation parameter (only used with :path)</li><li><code>use_basics::Bool=true</code> - Use basic solution from PATH (only used with :path)</li><li><code>use_start::Bool=true</code> - Use starting point from PATH (only used with :path)</li></ul><p><strong>Returns</strong></p><p>Named tuple with fields:</p><ul><li><code>sol::Vector{Float64}</code> - Solution vector (concatenated player decision variables)</li><li><code>status::Symbol</code> - Solver status (<code>:solved</code> or <code>:failed</code>)</li><li><code>info</code> - PATH solver info (only for <code>:path</code> backend, <code>nothing</code> for <code>:linear</code>)</li><li><code>vars</code> - Symbolic variables from precomputation</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L83-L101">source</a></section><section><div><pre><code class="language-julia hljs">solve_raw(solver::NonlinearSolver, parameter_values::Dict; kwargs...)</code></pre><p>Solve and return raw solution with convergence info (for debugging/analysis).</p><p><strong>Keyword Arguments</strong></p><ul><li><code>initial_guess::Union{Nothing, Vector}=nothing</code> - Warm start for the solver</li><li><code>max_iters::Int</code> - Maximum iterations (default from solver.options)</li><li><code>tol::Float64</code> - Convergence tolerance (default from solver.options)</li><li><code>verbose::Bool</code> - Print iteration info (default from solver.options)</li><li><code>linesearch_method::Symbol</code> - Line search method (default from solver.options)</li><li><code>recompute_policy_in_linesearch::Bool</code> - Recompute K matrices at each line search trial step (default from solver.options)</li><li><code>show_progress::Bool</code> - Display iteration progress table (default from solver.options)</li></ul><p><strong>Returns</strong></p><p>Named tuple with fields:</p><ul><li><code>sol::Vector{Float64}</code> - Solution vector (concatenated player decision variables)</li><li><code>converged::Bool</code> - Whether solver converged to tolerance</li><li><code>iterations::Int</code> - Number of iterations taken</li><li><code>residual::Float64</code> - Final KKT residual norm</li><li><code>status::Symbol</code> - Solver status:<ul><li><code>:solved</code> - Converged successfully</li><li><code>:solved_initial_point</code> - Initial guess was already a solution</li><li><code>:max_iters_reached</code> - Did not converge within iteration limit</li><li><code>:linear_solver_error</code> - Newton step computation failed</li><li><code>:line_search_failed</code> - Armijo line search failed to find sufficient decrease</li><li><code>:numerical_error</code> - NaN or Inf encountered</li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L243-L270">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.solve_with_path"><a class="docstring-binding" href="#MixedHierarchyGames.solve_with_path"><code>MixedHierarchyGames.solve_with_path</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">solve_with_path(parametric_mcp, θs::Dict, parameter_values::Dict; kwargs...)</code></pre><p>Solve KKT system using PATH solver via ParametricMCPs.jl with cached MCP.</p><p><strong>Arguments</strong></p><ul><li><code>parametric_mcp</code> - Precomputed ParametricMCP from QPSolver construction</li><li><code>θs::Dict</code> - Symbolic parameter variables per player</li><li><code>parameter_values::Dict</code> - Numerical parameter values per player</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>initial_guess::Union{Nothing, Vector}=nothing</code> - Warm start</li><li><code>verbose::Bool=false</code> - Print solver output</li><li><code>iteration_limit::Int=100000</code> - Maximum iterations for PATH solver</li><li><code>proximal_perturbation::Float64=1e-2</code> - Proximal perturbation parameter</li><li><code>use_basics::Bool=true</code> - Use basic solution from PATH</li><li><code>use_start::Bool=true</code> - Use starting point from PATH</li></ul><p><strong>Returns</strong></p><p>Tuple of:</p><ul><li><code>sol::Vector</code> - Solution vector</li><li><code>status::Symbol</code> - Solver status (:solved, :failed, etc.)</li><li><code>info</code> - PATH solver info</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L364-L387">source</a></section><section><div><pre><code class="language-julia hljs">solve_with_path(πs::Dict, variables::Vector, θs::Dict, parameter_values::Dict; kwargs...)</code></pre><p>Solve KKT system using PATH solver via ParametricMCPs.jl (builds MCP internally).</p><p><strong>Arguments</strong></p><ul><li><code>πs::Dict</code> - KKT conditions per player</li><li><code>variables::Vector</code> - All symbolic variables</li><li><code>θs::Dict</code> - Symbolic parameter variables per player</li><li><code>parameter_values::Dict</code> - Numerical parameter values per player</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>initial_guess::Union{Nothing, Vector}=nothing</code> - Warm start</li><li><code>verbose::Bool=false</code> - Print solver output</li><li><code>iteration_limit::Int=100000</code> - Maximum iterations for PATH solver</li><li><code>proximal_perturbation::Float64=1e-2</code> - Proximal perturbation parameter</li><li><code>use_basics::Bool=true</code> - Use basic solution from PATH</li><li><code>use_start::Bool=true</code> - Use starting point from PATH</li></ul><p><strong>Returns</strong></p><p>Tuple of:</p><ul><li><code>sol::Vector</code> - Solution vector</li><li><code>status::Symbol</code> - Solver status (:solved, :failed, etc.)</li><li><code>info</code> - PATH solver info</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L422-L446">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.solve_qp_linear"><a class="docstring-binding" href="#MixedHierarchyGames.solve_qp_linear"><code>MixedHierarchyGames.solve_qp_linear</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">solve_qp_linear(parametric_mcp, θs::Dict, parameter_values::Dict; kwargs...)</code></pre><p>Solve LQ game KKT system using direct linear solve with cached MCP.</p><p>For LQ games with only equality constraints, the KKT system is linear: Jz = -F where J is the Jacobian and F is the KKT residual.</p><p><strong>Arguments</strong></p><ul><li><code>parametric_mcp</code> - Precomputed ParametricMCP from QPSolver construction</li><li><code>θs::Dict</code> - Symbolic parameter variables per player</li><li><code>parameter_values::Dict</code> - Numerical parameter values per player</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>verbose::Bool=false</code> - Print solver output</li></ul><p><strong>Returns</strong></p><p>Tuple of:</p><ul><li><code>sol::Vector</code> - Solution vector</li><li><code>status::Symbol</code> - Solver status (:solved or :failed)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L505-L525">source</a></section><section><div><pre><code class="language-julia hljs">solve_qp_linear(πs::Dict, variables::Vector, θs::Dict, parameter_values::Dict; kwargs...)</code></pre><p>Solve LQ game KKT system using direct linear solve (builds MCP internally).</p><p>For LQ games with only equality constraints, the KKT system is linear: Jz = -F where J is the Jacobian and F is the KKT residual.</p><p><strong>Arguments</strong></p><ul><li><code>πs::Dict</code> - KKT conditions per player</li><li><code>variables::Vector</code> - All symbolic variables</li><li><code>θs::Dict</code> - Symbolic parameter variables per player</li><li><code>parameter_values::Dict</code> - Numerical parameter values per player</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>verbose::Bool=false</code> - Print solver output</li></ul><p><strong>Returns</strong></p><p>Tuple of:</p><ul><li><code>sol::Vector</code> - Solution vector</li><li><code>status::Symbol</code> - Solver status (:solved or :failed)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L592-L613">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.qp_game_linsolve"><a class="docstring-binding" href="#MixedHierarchyGames.qp_game_linsolve"><code>MixedHierarchyGames.qp_game_linsolve</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">qp_game_linsolve(A, b; kwargs...)</code></pre><p>Solve linear system Ax = b for QP games.</p><p>For LQ games, the KKT system is linear so this directly solves for the solution.</p><p><strong>Arguments</strong></p><ul><li><code>A</code> - System matrix (Jacobian of KKT conditions)</li><li><code>b</code> - Right-hand side</li></ul><p><strong>Returns</strong></p><ul><li><code>x::Vector</code> - Solution vector</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L485-L498">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.run_nonlinear_solver"><a class="docstring-binding" href="#MixedHierarchyGames.run_nonlinear_solver"><code>MixedHierarchyGames.run_nonlinear_solver</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">run_nonlinear_solver(
    precomputed::NamedTuple,
    initial_states::Dict,
    hierarchy_graph::SimpleDiGraph;
    initial_guess::Union{Nothing, Vector{Float64}} = nothing,
    max_iters::Int = 100,
    tol::Float64 = 1e-6,
    verbose::Bool = false,
    linesearch_method::Symbol = :geometric,
    recompute_policy_in_linesearch::Bool = true,
    use_sparse::Bool = false,
    show_progress::Bool = false,
    to::TimerOutput = TimerOutput()
)</code></pre><p>Orchestrates the Newton iteration loop for solving nonlinear hierarchy games.</p><p>Each iteration: evaluate the KKT residual, check convergence, compute a Newton step via <a href="#MixedHierarchyGames.compute_newton_step"><code>compute_newton_step</code></a>, and select a step size via configurable line search. Convergence is checked by <a href="#MixedHierarchyGames.check_convergence"><code>check_convergence</code></a>.</p><p><strong>Arguments</strong></p><ul><li><code>precomputed::NamedTuple</code> - Precomputed symbolic components from <a href="#MixedHierarchyGames.preoptimize_nonlinear_solver"><code>preoptimize_nonlinear_solver</code></a></li><li><code>initial_states::Dict</code> - Initial state for each player (keyed by player index)</li><li><code>hierarchy_graph::SimpleDiGraph</code> - Player hierarchy graph</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>initial_guess::Union{Nothing, Vector{Float64}}=nothing</code> - Starting point (zero-initialized if <code>nothing</code>)</li><li><code>max_iters::Int=100</code> - Maximum Newton iterations</li><li><code>tol::Float64=1e-6</code> - Convergence tolerance on KKT residual norm</li><li><code>verbose::Bool=false</code> - Print per-iteration convergence info</li><li><code>linesearch_method::Symbol=:geometric</code> - Line search method (:armijo, :geometric, or :constant)</li><li><code>recompute_policy_in_linesearch::Bool=true</code> - Recompute K matrices at each line search trial step. Set to <code>false</code> for ~1.6x speedup (reuses K from current Newton iteration).</li><li><code>use_sparse::Bool=false</code> - Use sparse LU for M\N solve (beneficial for large problems)</li><li><code>show_progress::Bool=false</code> - Display iteration progress table (iter, residual, step size, time)</li><li><code>to::TimerOutput=TimerOutput()</code> - Timer for profiling solver phases</li></ul><p><strong>Returns</strong></p><p>Named tuple <code>(; sol, converged, iterations, residual, status)</code>:</p><ul><li><code>sol::Vector{Float64}</code> - Solution vector</li><li><code>converged::Bool</code> - Whether the solver reached the tolerance</li><li><code>iterations::Int</code> - Number of iterations performed</li><li><code>residual::Float64</code> - Final KKT residual norm</li><li><code>status::Symbol</code> - One of <code>:solved</code>, <code>:solved_initial_point</code>, <code>:max_iters_reached</code>, <code>:linear_solver_error</code>, <code>:line_search_failed</code>, <code>:numerical_error</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L692-L738">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.extract_trajectories"><a class="docstring-binding" href="#MixedHierarchyGames.extract_trajectories"><code>MixedHierarchyGames.extract_trajectories</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">extract_trajectories(sol::Vector, dims::NamedTuple, T::Int, n_players::Int)</code></pre><p>Extract state and control trajectories from flattened solution vector.</p><p><strong>Arguments</strong></p><ul><li><code>sol::Vector</code> - Flattened solution</li><li><code>dims::NamedTuple</code> - Dimension info per player</li><li><code>T::Int</code> - Time horizon</li><li><code>n_players::Int</code> - Number of players</li></ul><p><strong>Returns</strong></p><ul><li><code>xs::Dict{Int, Vector{Vector}}</code> - State trajectories per player</li><li><code>us::Dict{Int, Vector{Vector}}</code> - Control trajectories per player</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L669-L683">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.solution_to_joint_strategy"><a class="docstring-binding" href="#MixedHierarchyGames.solution_to_joint_strategy"><code>MixedHierarchyGames.solution_to_joint_strategy</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">solution_to_joint_strategy(xs::Dict, us::Dict, n_players::Int)</code></pre><p>Convert trajectory dictionaries to JointStrategy of OpenLoopStrategys.</p><p><strong>Arguments</strong></p><ul><li><code>xs::Dict</code> - State trajectories per player</li><li><code>us::Dict</code> - Control trajectories per player</li><li><code>n_players::Int</code> - Number of players</li></ul><p><strong>Returns</strong></p><ul><li><code>JointStrategy</code> over <code>OpenLoopStrategy</code>s</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L709-L721">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.split_solution_vector"><a class="docstring-binding" href="#MixedHierarchyGames.split_solution_vector"><code>MixedHierarchyGames.split_solution_vector</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">split_solution_vector(sol::AbstractVector, block_sizes::Vector{Int})</code></pre><p>Split a flat vector into blocks using BlockArrays.</p><p>Returns an iterable of blocks where each block is a view into the original vector. Uses <code>PseudoBlockVector</code> for a zero-copy view.</p><p><strong>Arguments</strong></p><ul><li><code>sol</code> - Flat vector to split</li><li><code>block_sizes</code> - Size of each block</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">sol = [1.0, 2.0, 3.0, 4.0, 5.0]
player_blocks = split_solution_vector(sol, [2, 3])
# blocks: [[1.0, 2.0], [3.0, 4.0, 5.0]]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L95-L113">source</a></section></details></article><h2 id="Solver-Helpers"><a class="docs-heading-anchor" href="#Solver-Helpers">Solver Helpers</a><a id="Solver-Helpers-1"></a><a class="docs-heading-anchor-permalink" href="#Solver-Helpers" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.check_convergence"><a class="docstring-binding" href="#MixedHierarchyGames.check_convergence"><code>MixedHierarchyGames.check_convergence</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">check_convergence(residual, tol; verbose=false, iteration=nothing)</code></pre><p>Check whether the solver has converged based on the KKT residual norm.</p><p>Returns a named tuple <code>(converged, status)</code> where:</p><ul><li><code>converged::Bool</code> - whether the residual is below tolerance</li><li><code>status::Symbol</code> - <code>:solved</code>, <code>:not_converged</code>, or <code>:numerical_error</code></li></ul><p><strong>Arguments</strong></p><ul><li><code>residual::Real</code> - Current KKT residual norm</li><li><code>tol::Real</code> - Convergence tolerance</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>verbose::Bool=false</code> - Print convergence info</li><li><code>iteration::Union{Nothing,Int}=nothing</code> - Current iteration number (for verbose output)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L19-L35">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.compute_newton_step"><a class="docstring-binding" href="#MixedHierarchyGames.compute_newton_step"><code>MixedHierarchyGames.compute_newton_step</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">compute_newton_step(linsolver, jacobian, neg_residual)</code></pre><p>Solve the Newton step linear system <code>jacobian * δz = neg_residual</code>.</p><p>Uses the provided LinearSolve solver instance for the factorization and solve. Handles singular matrix errors gracefully by returning <code>success=false</code>.</p><p><strong>Arguments</strong></p><ul><li><code>linsolver</code> - Initialized LinearSolve solver (mutated in place)</li><li><code>jacobian</code> - Jacobian matrix (∇F)</li><li><code>neg_residual</code> - Negative residual vector (-F)</li></ul><p><strong>Returns</strong></p><p>Named tuple <code>(step, success)</code> where:</p><ul><li><code>step::Vector</code> - Newton step direction δz (undefined if <code>success=false</code>)</li><li><code>success::Bool</code> - Whether the linear solve succeeded</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L55-L72">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.perform_linesearch"><a class="docstring-binding" href="#MixedHierarchyGames.perform_linesearch"><code>MixedHierarchyGames.perform_linesearch</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">perform_linesearch(residual_norm_fn, z_est, δz, current_residual_norm; use_armijo=true)</code></pre><p>Perform backtracking line search to select step size for Newton update.</p><p>When <code>use_armijo=true</code>, backtracks from α=1.0 by halving until the trial point has a smaller residual norm than the current point, or max iterations are reached. When <code>use_armijo=false</code>, returns α=1.0 (full Newton step).</p><p><strong>Arguments</strong></p><ul><li><code>residual_norm_fn</code> - Function <code>z_trial -&gt; Float64</code> returning residual norm at trial point</li><li><code>z_est::Vector</code> - Current iterate</li><li><code>δz::Vector</code> - Newton step direction</li><li><code>current_residual_norm::Float64</code> - Residual norm at current iterate</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>use_armijo::Bool=true</code> - Whether to perform backtracking line search</li></ul><p><strong>Returns</strong></p><ul><li><code>α::Float64</code> - Selected step size</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L88-L108">source</a></section></details></article><h2 id="Linesearch-Methods"><a class="docs-heading-anchor" href="#Linesearch-Methods">Linesearch Methods</a><a id="Linesearch-Methods-1"></a><a class="docs-heading-anchor-permalink" href="#Linesearch-Methods" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.armijo_backtracking"><a class="docstring-binding" href="#MixedHierarchyGames.armijo_backtracking"><code>MixedHierarchyGames.armijo_backtracking</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">armijo_backtracking(f, x, d, alpha_init; c1=1e-4, rho=0.5, max_iters=20)</code></pre><p>Armijo backtracking line search for step size selection.</p><p>Uses the merit function ϕ(x) = ||f(x)||² and checks the sufficient decrease condition:</p><pre><code class="language-julia hljs">ϕ(x + α*d) ≤ ϕ(x) + c1 * α * ∇ϕ&#39;*d</code></pre><p>where for Newton-like methods ∇ϕ&#39;<em>d ≈ -2</em>||f(x)||².</p><p><strong>Arguments</strong></p><ul><li><code>f::Function</code> - Residual function evaluating at a point, returns a vector</li><li><code>x::Vector</code> - Current point</li><li><code>d::Vector</code> - Search direction (typically the Newton step)</li><li><code>alpha_init::Float64</code> - Initial step size</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>c1::Float64=1e-4</code> - Sufficient decrease parameter (Armijo constant)</li><li><code>rho::Float64=0.5</code> - Step size reduction factor per backtracking iteration</li><li><code>max_iters::Int=20</code> - Maximum number of backtracking iterations</li></ul><p><strong>Returns</strong></p><ul><li><code>α::Float64</code> - Selected step size, or <code>0.0</code> if no sufficient decrease found</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/linesearch.jl#L1-L25">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.geometric_reduction"><a class="docstring-binding" href="#MixedHierarchyGames.geometric_reduction"><code>MixedHierarchyGames.geometric_reduction</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">geometric_reduction(f, x, d, alpha_init; rho=0.5, max_iters=20)</code></pre><p>Geometric step-size reduction line search.</p><p>Reduces the step size by a fixed factor <code>rho</code> each iteration until the merit function ϕ(x) = ||f(x)||² strictly decreases:</p><pre><code class="language-julia hljs">ϕ(x + α*d) &lt; ϕ(x)</code></pre><p>This is a simpler alternative to <code>armijo_backtracking</code> — it requires only strict decrease rather than sufficient decrease, and has no Armijo constant <code>c1</code>.</p><p><strong>Arguments</strong></p><ul><li><code>f::Function</code> - Residual function evaluating at a point, returns a vector</li><li><code>x::Vector</code> - Current point</li><li><code>d::Vector</code> - Search direction (typically the Newton step)</li><li><code>alpha_init::Float64</code> - Initial step size</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>rho::Float64=0.5</code> - Step size reduction factor per iteration</li><li><code>max_iters::Int=20</code> - Maximum number of reduction iterations</li></ul><p><strong>Returns</strong></p><ul><li><code>α::Float64</code> - Selected step size, or <code>0.0</code> if no decrease found</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/linesearch.jl#L55-L80">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.constant_step"><a class="docstring-binding" href="#MixedHierarchyGames.constant_step"><code>MixedHierarchyGames.constant_step</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">constant_step(alpha)</code></pre><p>Create a constant step-size line search that always returns <code>alpha</code>.</p><p>Returns a closure with the same interface as other line search methods <code>(f, x, d, alpha_init) -&gt; α</code>, but ignores all arguments and returns the fixed step size.</p><p>Useful as a baseline or when the appropriate step size is known a priori.</p><p><strong>Arguments</strong></p><ul><li><code>alpha::Float64</code> - The fixed step size to return</li></ul><p><strong>Returns</strong></p><ul><li>A function <code>(f, x, d, alpha_init) -&gt; alpha</code> that always returns the fixed step size</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/linesearch.jl#L107-L122">source</a></section></details></article><h2 id="KKT-Construction"><a class="docs-heading-anchor" href="#KKT-Construction">KKT Construction</a><a id="KKT-Construction-1"></a><a class="docs-heading-anchor-permalink" href="#KKT-Construction" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.get_qp_kkt_conditions"><a class="docstring-binding" href="#MixedHierarchyGames.get_qp_kkt_conditions"><code>MixedHierarchyGames.get_qp_kkt_conditions</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_qp_kkt_conditions(
    G::SimpleDiGraph,
    Js::Dict,
    zs,
    λs,
    μs::Dict,
    gs,
    ws::Dict,
    ys::Dict,
    ws_z_indices::Dict;
    θ = nothing,
    verbose::Bool = false
)</code></pre><p>Construct KKT conditions for all players in reverse topological order.</p><p>Handles both leaf and non-leaf players differently:</p><ul><li>Leaf players: Standard KKT (stationarity + constraints)</li><li>Non-leaf players: KKT with policy constraints from followers, stored as <code>BlockVector</code> via <code>mortar</code> to preserve the interleaved block structure</li></ul><p><strong>Arguments</strong></p><ul><li><code>G::SimpleDiGraph</code> - DAG of leader-follower relationships</li><li><code>Js::Dict{Int, Function}</code> - Cost function for each player: Js<a href="zs...; θ">i</a> → scalar</li><li><code>zs</code> - Decision variables per player (Dict or Vector)</li><li><code>λs</code> - Lagrange multipliers per player (Dict or Vector)</li><li><code>μs::Dict{Tuple{Int,Int}, Any}</code> - Policy constraint multipliers for (leader, follower) pairs</li><li><code>gs</code> - Constraint functions per player: gs<a href="z">i</a> → Vector</li><li><code>ws::Dict</code> - Remaining variables (for policy constraints)</li><li><code>ys::Dict</code> - Information variables (leader decisions)</li><li><code>ws_z_indices::Dict</code> - Index mapping: ws<em>z</em>indices[i][j] gives range where zs[j] appears in ws[i]</li><li><code>θ</code> - Parameter variables (optional)</li><li><code>verbose::Bool</code> - Print debug info</li></ul><p><strong>Returns</strong></p><p>Named tuple containing:</p><ul><li><code>πs::Dict</code> - KKT conditions per player (BlockVector for leaders, Vector for leaves)</li><li><code>Ms::Dict</code> - M matrices for followers (from Mw + Ny = 0)</li><li><code>Ns::Dict</code> - N matrices for followers</li><li><code>Ks::Dict</code> - Policy matrices K = M \ N</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/qp_kkt.jl#L27-L68">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.strip_policy_constraints"><a class="docstring-binding" href="#MixedHierarchyGames.strip_policy_constraints"><code>MixedHierarchyGames.strip_policy_constraints</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">strip_policy_constraints(πs::Dict, hierarchy_graph::SimpleDiGraph, zs::Dict, gs)</code></pre><p>Remove policy constraint rows from KKT conditions, keeping only stationarity + constraints.</p><p>Used for solving the reduced KKT system.</p><p><strong>Arguments</strong></p><ul><li><code>πs::Dict</code> - Full KKT conditions per player</li><li><code>hierarchy_graph::SimpleDiGraph</code> - Hierarchy graph</li><li><code>zs::Dict</code> - Decision variables per player</li><li><code>gs</code> - Constraint functions per player</li></ul><p><strong>Returns</strong></p><ul><li><code>πs_stripped::Dict</code> - KKT conditions without policy constraint rows</li></ul><p><strong>Notes</strong></p><p>The KKT conditions have an <strong>interleaved</strong> structure for leaders:</p><pre><code class="language-julia hljs">[grad_self | grad_f1 | policy_f1 | grad_f2 | policy_f2 | ... | own_constraints]</code></pre><p>When <code>πs[ii]</code> is a <code>BlockVector</code> (from <code>get_qp_kkt_conditions</code>), blocks are accessed directly. For plain vectors (from the nonlinear solver), block sizes are computed and <code>split_solution_vector</code> is used. In both cases, policy blocks at indices 3, 5, 7, ... are removed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/qp_kkt.jl#L172-L197">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.setup_approximate_kkt_solver"><a class="docstring-binding" href="#MixedHierarchyGames.setup_approximate_kkt_solver"><code>MixedHierarchyGames.setup_approximate_kkt_solver</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">setup_approximate_kkt_solver(
    G::SimpleDiGraph,
    Js::Dict,
    zs::Dict,
    λs::Dict,
    μs::Dict,
    gs::Vector,
    ws::Dict,
    ys::Dict,
    θs::Dict,
    all_variables::Vector,
    backend;
    verbose::Bool = false
)</code></pre><p>Precompute symbolic KKT conditions and M/N matrix evaluation functions for nonlinear solver.</p><p>Unlike QP KKT construction which computes K = M \ N symbolically, this creates compiled functions for evaluating M and N numerically, avoiding expression blowup.</p><p><strong>Arguments</strong></p><ul><li><code>G::SimpleDiGraph</code> - Hierarchy graph</li><li><code>Js::Dict</code> - Cost functions per player</li><li><code>zs::Dict</code> - Decision variables per player</li><li><code>λs::Dict</code> - Lagrange multipliers per player</li><li><code>μs::Dict</code> - Policy constraint multipliers</li><li><code>gs::Vector</code> - Constraint functions per player</li><li><code>ws::Dict</code> - Remaining variables (policy output)</li><li><code>ys::Dict</code> - Information variables (policy input)</li><li><code>θs::Dict</code> - Parameter variables per player</li><li><code>all_variables::Vector</code> - All symbolic variables</li><li><code>backend</code> - SymbolicTracingUtils backend</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>verbose::Bool=false</code> - Print debug info</li><li><code>cse::Bool=false</code> - Enable Common Subexpression Elimination during symbolic compilation. CSE can dramatically reduce construction time and memory for problems with redundant symbolic structure (e.g., quadratic costs), but may slightly increase per-solve runtime. Recommended only when construction time is a bottleneck and you can tolerate slightly slower solve times. Default: false for maximum runtime performance.</li></ul><p><strong>Returns</strong></p><p>Tuple of:</p><ul><li><code>all_augmented_variables::Vector</code> - Variables including K matrix symbols</li><li><code>setup_info::NamedTuple</code> - Contains:<ul><li><code>graph</code> - Hierarchy graph</li><li><code>πs</code> - KKT conditions per player</li><li><code>K_syms</code> - Symbolic K matrices per player</li><li><code>M_fns</code> - Compiled M matrix evaluation functions</li><li><code>N_fns</code> - Compiled N matrix evaluation functions</li><li><code>π_sizes</code> - KKT condition sizes per player</li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L169-L221">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.preoptimize_nonlinear_solver"><a class="docstring-binding" href="#MixedHierarchyGames.preoptimize_nonlinear_solver"><code>MixedHierarchyGames.preoptimize_nonlinear_solver</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">preoptimize_nonlinear_solver(
    hierarchy_graph::SimpleDiGraph,
    Js::Dict,
    gs::Vector,
    primal_dims::Vector{Int},
    θs::Dict;
    state_dim::Int = 2,
    control_dim::Int = 2,
    backend = default_backend(),
    verbose::Bool = false
)</code></pre><p>Precompute all symbolic components for nonlinear solver.</p><p>This is called once before solving to build all the symbolic expressions and compile them to efficient numerical functions.</p><p><strong>Arguments</strong></p><ul><li><code>hierarchy_graph::SimpleDiGraph</code> - Hierarchy graph</li><li><code>Js::Dict</code> - Cost functions per player</li><li><code>gs::Vector</code> - Constraint functions per player</li><li><code>primal_dims::Vector{Int}</code> - Primal variable dimension per player</li><li><code>θs::Dict</code> - Parameter variables per player</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>state_dim::Int=2</code> - State dimension (for trajectory extraction)</li><li><code>control_dim::Int=2</code> - Control dimension (for trajectory extraction)</li><li><code>backend</code> - SymbolicTracingUtils backend</li><li><code>verbose::Bool=false</code> - Print debug info</li><li><code>cse::Bool=false</code> - Enable Common Subexpression Elimination during symbolic compilation. CSE can dramatically reduce construction time and memory for problems with redundant symbolic structure (e.g., quadratic costs), but may slightly increase per-solve runtime. Recommended only when construction time is a bottleneck and you can tolerate slightly slower solve times. Default: false for maximum runtime performance.</li></ul><p><strong>Returns</strong></p><p>Named tuple containing:</p><ul><li><code>problem_vars</code> - Problem variables (zs, λs, μs, ws, ys, all_variables)</li><li><code>setup_info</code> - Setup info from setup<em>approximate</em>kkt_solver</li><li><code>mcp_obj</code> - ParametricMCP object for residual evaluation</li><li><code>linsolver</code> - LinearSolve problem for iterative solving</li><li><code>all_variables</code> - All symbolic variables</li><li><code>all_augmented_variables</code> - Variables including K matrices</li><li><code>F_sym</code> - Symbolic KKT residual vector</li><li><code>π_sizes_trimmed</code> - Trimmed KKT sizes per player</li><li><code>state_dim</code> - State dimension</li><li><code>control_dim</code> - Control dimension</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L354-L402">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.compute_K_evals"><a class="docstring-binding" href="#MixedHierarchyGames.compute_K_evals"><code>MixedHierarchyGames.compute_K_evals</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">compute_K_evals(z_current, problem_vars, setup_info; use_sparse=false, buffers=nothing)</code></pre><p>Evaluate K (policy) matrices numerically in reverse topological order.</p><p>Note: This function is NOT thread-safe. The precomputed M<em>fns and N</em>fns contain shared result buffers that would cause data races if called concurrently. For multi-threaded use, each thread needs its own solver instance. See Phase 6 for planned thread-safety improvements.</p><p><strong>Arguments</strong></p><ul><li><code>z_current::Vector</code> - Current solution estimate</li><li><code>problem_vars::NamedTuple</code> - Problem variables (from setup<em>problem</em>variables)</li><li><code>setup_info::NamedTuple</code> - Setup info (from setup<em>approximate</em>kkt_solver)</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>use_sparse::Bool=false</code> - If true, use sparse LU factorization for M\N solve. Beneficial for large M matrices (&gt;100 rows) with structural sparsity from the KKT system. For small matrices, dense solve is faster due to sparse overhead.</li><li><code>buffers::Union{Nothing, NamedTuple}=nothing</code> - Pre-allocated buffers to reuse across calls, reducing Dict and vector allocation overhead. When provided, must contain fields: <code>M_evals</code>, <code>N_evals</code>, <code>K_evals</code>, <code>follower_cache</code>, <code>buffer_cache</code>, and <code>all_K_vec</code>. When <code>nothing</code>, fresh containers are allocated each call.</li></ul><p><strong>Returns</strong></p><p>Tuple of:</p><ul><li><code>all_K_vec::Vector</code> - Concatenated K matrix values for all players</li><li><code>info::NamedTuple</code> - Contains M<em>evals, N</em>evals, K_evals, status<ul><li><code>status</code> is <code>:ok</code> or <code>:singular_matrix</code></li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L546-L575">source</a></section></details></article><h2 id="Problem-Setup"><a class="docs-heading-anchor" href="#Problem-Setup">Problem Setup</a><a id="Problem-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-Setup" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.setup_problem_variables"><a class="docstring-binding" href="#MixedHierarchyGames.setup_problem_variables"><code>MixedHierarchyGames.setup_problem_variables</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">setup_problem_variables(
    graph::SimpleDiGraph,
    primal_dims::Vector{Int},
    gs::Vector;
    backend=default_backend()
)</code></pre><p>Construct all symbolic variables needed for the KKT system.</p><p><strong>Arguments</strong></p><ul><li><code>graph::SimpleDiGraph</code> - DAG of leader-follower relationships</li><li><code>primal_dims::Vector{Int}</code> - Decision variable dimension for each player</li><li><code>gs::Vector</code> - Constraint functions for each player (gs<a href="z">i</a> returns constraints)</li><li><code>backend</code> - SymbolicTracingUtils backend (default: SymbolicsBackend)</li></ul><p><strong>Returns</strong></p><p>Named tuple containing:</p><ul><li><code>zs::Dict</code> - Decision variables per player</li><li><code>λs::Dict</code> - Lagrange multipliers for constraints per player</li><li><code>μs::Dict</code> - Policy constraint multipliers (leader, follower) pairs</li><li><code>ys::Dict</code> - Information vectors (leader decisions visible to each player)</li><li><code>ws::Dict</code> - Remaining variables for policy constraints</li><li><code>ws_z_indices::Dict</code> - Index mapping: ws<em>z</em>indices[i][j] gives range where zs[j] appears in ws[i]</li><li><code>all_variables::Vector</code> - Flattened vector of all variables</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/problem_setup.jl#L161-L186">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.setup_problem_parameter_variables"><a class="docstring-binding" href="#MixedHierarchyGames.setup_problem_parameter_variables"><code>MixedHierarchyGames.setup_problem_parameter_variables</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">setup_problem_parameter_variables(num_params_per_player::Vector{Int}; backend=default_backend())</code></pre><p>Create symbolic parameter variables (θ) for each player&#39;s initial state.</p><p><strong>Arguments</strong></p><ul><li><code>num_params_per_player::Vector{Int}</code> - Number of parameters for each player</li><li><code>backend</code> - SymbolicTracingUtils backend (default: SymbolicsBackend)</li></ul><p><strong>Returns</strong></p><ul><li><code>θs::Dict{Int, Vector}</code> - Dictionary mapping player index to their parameter variables</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/problem_setup.jl#L91-L102">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.make_symbolic_vector"><a class="docstring-binding" href="#MixedHierarchyGames.make_symbolic_vector"><code>MixedHierarchyGames.make_symbolic_vector</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">make_symbolic_vector(name::Symbol, player::Int, dim::Int; backend=default_backend())</code></pre><p>Create a vector of <code>dim</code> symbolic variables for a player.</p><p>Valid names: (:z, :λ, :θ, :u, :x, :M, :N, :K)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/problem_setup.jl#L50-L56">source</a></section><section><div><pre><code class="language-julia hljs">make_symbolic_vector(name::Symbol, leader::Int, follower::Int, dim::Int; backend=default_backend())</code></pre><p>Create a vector of <code>dim</code> symbolic variables for a leader-follower pair.</p><p>Valid names: (:μ,)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/problem_setup.jl#L62-L68">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.make_symbolic_matrix"><a class="docstring-binding" href="#MixedHierarchyGames.make_symbolic_matrix"><code>MixedHierarchyGames.make_symbolic_matrix</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">make_symbolic_matrix(name::Symbol, player::Int, rows::Int, cols::Int; backend=default_backend())</code></pre><p>Create a <code>rows × cols</code> matrix of symbolic variables for a player.</p><p>Valid names: (:z, :λ, :θ, :u, :x, :M, :N, :K)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/problem_setup.jl#L74-L80">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.make_symbol"><a class="docstring-binding" href="#MixedHierarchyGames.make_symbol"><code>MixedHierarchyGames.make_symbol</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">make_symbol(name::Symbol, player::Int)</code></pre><p>Create a symbol for a player variable. Valid names: (:z, :λ, :θ, :u, :x, :M, :N, :K)</p><p>Returns <code>Symbol(&quot;name^player&quot;)</code>, e.g., <code>Symbol(&quot;z^1&quot;)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/problem_setup.jl#L17-L23">source</a></section><section><div><pre><code class="language-julia hljs">make_symbol(name::Symbol, leader::Int, follower::Int)</code></pre><p>Create a symbol for a leader-follower pair variable. Valid names: (:μ,)</p><p>Returns <code>Symbol(&quot;name^(leader-follower)&quot;)</code>, e.g., <code>Symbol(&quot;μ^(1-2)&quot;)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/problem_setup.jl#L30-L36">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.default_backend"><a class="docstring-binding" href="#MixedHierarchyGames.default_backend"><code>MixedHierarchyGames.default_backend</code></a> — <span class="docstring-category">Function</span></summary><section><div><p>Return a fresh SymbolicsBackend instance for symbolic tracing.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/problem_setup.jl#L47">source</a></section></details></article><h2 id="Graph-Utilities"><a class="docs-heading-anchor" href="#Graph-Utilities">Graph Utilities</a><a id="Graph-Utilities-1"></a><a class="docs-heading-anchor-permalink" href="#Graph-Utilities" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.is_root"><a class="docstring-binding" href="#MixedHierarchyGames.is_root"><code>MixedHierarchyGames.is_root</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">is_root(G::SimpleDiGraph, node::Int)</code></pre><p>Check if node has no incoming edges (i.e., is a root/top-level leader).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L18-L22">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.is_leaf"><a class="docstring-binding" href="#MixedHierarchyGames.is_leaf"><code>MixedHierarchyGames.is_leaf</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">is_leaf(G::SimpleDiGraph, node::Int)</code></pre><p>Check if node has no outgoing edges (i.e., is a leaf/pure follower).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L27-L31">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.has_leader"><a class="docstring-binding" href="#MixedHierarchyGames.has_leader"><code>MixedHierarchyGames.has_leader</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">has_leader(G::SimpleDiGraph, node::Int)</code></pre><p>Check if node has any incoming edges (i.e., has a leader).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L9-L13">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.get_roots"><a class="docstring-binding" href="#MixedHierarchyGames.get_roots"><code>MixedHierarchyGames.get_roots</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_roots(G::SimpleDiGraph)</code></pre><p>Return all root nodes (nodes with no incoming edges).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L36-L40">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.get_all_leaders"><a class="docstring-binding" href="#MixedHierarchyGames.get_all_leaders"><code>MixedHierarchyGames.get_all_leaders</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_all_leaders(G::SimpleDiGraph, node::Int)</code></pre><p>Return all ancestors of node up to root (all direct and indirect leaders).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L45-L49">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.get_all_followers"><a class="docstring-binding" href="#MixedHierarchyGames.get_all_followers"><code>MixedHierarchyGames.get_all_followers</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">get_all_followers(G::SimpleDiGraph, node::Int)</code></pre><p>Return all descendants of node (entire subtree of followers).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L61-L65">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.evaluate_kkt_residuals"><a class="docstring-binding" href="#MixedHierarchyGames.evaluate_kkt_residuals"><code>MixedHierarchyGames.evaluate_kkt_residuals</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">evaluate_kkt_residuals(
    πs::Dict,
    all_variables::Vector,
    sol::Vector,
    θs::Dict,
    parameter_values::Dict;
    tol::Float64 = 1e-6,
    verbose::Bool = false,
    should_enforce::Bool = false
)</code></pre><p>Evaluate symbolic KKT conditions at the numerical solution.</p><p>Substitutes numerical values and computes residual norms to verify solution validity.</p><p><strong>Arguments</strong></p><ul><li><code>πs::Dict{Int, Any}</code> - Symbolic KKT conditions per player</li><li><code>all_variables::Vector</code> - All symbolic decision variables</li><li><code>sol::Vector</code> - Numerical solution vector</li><li><code>θs::Dict{Int, Any}</code> - Symbolic parameter variables per player</li><li><code>parameter_values::Dict{Int, Vector}</code> - Numerical values for parameters</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>tol::Float64=1e-6</code> - Tolerance for checking satisfaction</li><li><code>verbose::Bool=false</code> - Print residual details</li><li><code>should_enforce::Bool=false</code> - Assert if conditions not satisfied</li></ul><p><strong>Returns</strong></p><ul><li><code>π_eval::Vector{Float64}</code> - Evaluated residual vector</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L129-L159">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.verify_kkt_solution"><a class="docstring-binding" href="#MixedHierarchyGames.verify_kkt_solution"><code>MixedHierarchyGames.verify_kkt_solution</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">verify_kkt_solution(solver, sol::Vector, θs::Dict, parameter_values::Dict; kwargs...)</code></pre><p>Verify that a solution satisfies the KKT conditions. The solver must have <code>precomputed.setup_info.πs</code> and related fields (NonlinearSolver).</p><p>This is a convenience wrapper that extracts the necessary data from the solver and calls <code>evaluate_kkt_residuals</code>.</p><p>Note: For NonlinearSolver, this function evaluates the KKT conditions with the actual K (policy derivative) values computed at the solution. The residuals should be small for a properly converged solution.</p><p><strong>Arguments</strong></p><ul><li><code>solver</code> - The solver used to find the solution (NonlinearSolver)</li><li><code>sol::Vector</code> - The solution vector (from <code>result.sol</code>)</li><li><code>θs::Dict</code> - Symbolic parameter variables per player</li><li><code>parameter_values::Dict</code> - Numerical values for parameters</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>tol::Float64=1e-6</code> - Tolerance for checking satisfaction</li><li><code>verbose::Bool=false</code> - Print residual details</li><li><code>should_enforce::Bool=false</code> - Assert if conditions not satisfied</li></ul><p><strong>Returns</strong></p><ul><li><code>π_eval::Vector{Float64}</code> - Evaluated residual vector</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">result = solve_raw(solver, parameter_values)
residuals = verify_kkt_solution(solver, result.sol, θs, parameter_values; verbose=true)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L229-L261">source</a></section></details></article><h2 id="Internal-Functions"><a class="docs-heading-anchor" href="#Internal-Functions">Internal Functions</a><a id="Internal-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-Functions" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._build_augmented_z_est-NTuple{6, Any}"><a class="docstring-binding" href="#MixedHierarchyGames._build_augmented_z_est-NTuple{6, Any}"><code>MixedHierarchyGames._build_augmented_z_est</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_build_augmented_z_est(ii, z_est, K_evals, graph, follower_cache, buffer_cache)</code></pre><p>Build augmented z vector for player ii including follower K evaluations.</p><p><strong>Arguments</strong></p><ul><li><code>ii::Int</code> - Player index</li><li><code>z_est::Vector</code> - Current z estimate</li><li><code>K_evals::Dict</code> - Numerical K matrices per player</li><li><code>graph::SimpleDiGraph</code> - Hierarchy graph</li><li><code>follower_cache::Dict</code> - Cache for follower lists</li><li><code>buffer_cache::Dict</code> - Cache for augmented buffers</li></ul><p><strong>Returns</strong></p><ul><li><code>augmented_z::Vector</code> - z_est augmented with follower K values</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L493-L508">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._build_extractor-Tuple{UnitRange{Int64}, Int64}"><a class="docstring-binding" href="#MixedHierarchyGames._build_extractor-Tuple{UnitRange{Int64}, Int64}"><code>MixedHierarchyGames._build_extractor</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_build_extractor(indices::UnitRange{Int}, total_len::Int)</code></pre><p>Build a sparse extraction matrix for policy constraints.</p><p>Used to extract the follower&#39;s decision variables (zs[j]) from the full policy response (Ks[j] * ys[j]). The indices come from ws<em>z</em>indices, which explicitly tracks where each player&#39;s variables appear in the ws vector.</p><p><strong>Example</strong></p><p>If ws[j] = [zs[j], zs[other], λs[j], ...] and zs[j] has dimension 3, then:</p><ul><li>indices = 1:3 (from ws<em>z</em>indices[j][j])</li><li>extractor * (Ks[j] * ys[j]) gives the zs[j] portion of the policy response</li></ul><p>Returns a sparse matrix E such that E * v extracts v[indices].</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/qp_kkt.jl#L5-L20">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._build_parametric_mcp-Tuple{Dict, Vector, Dict}"><a class="docstring-binding" href="#MixedHierarchyGames._build_parametric_mcp-Tuple{Dict, Vector, Dict}"><code>MixedHierarchyGames._build_parametric_mcp</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_build_parametric_mcp(πs::Dict, variables::Vector, θs::Dict)</code></pre><p>Build a ParametricMCP from KKT conditions during QPSolver construction.</p><p>The MCP is cached in <code>precomputed</code> to avoid rebuilding it on each solve() call. This provides significant performance benefits for repeated solves with different parameter values (e.g., different initial states).</p><p>Note: We use ParametricMCPs primarily for its compiled f! and jacobian_z! functions. The bounds infrastructure (-∞ to ∞) is unused since we only support equality constraints. See task MixedHierarchyGames.jl-s6u for potential future optimization.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/types.jl#L152-L164">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._construct_augmented_variables-NTuple{4, Any}"><a class="docstring-binding" href="#MixedHierarchyGames._construct_augmented_variables-NTuple{4, Any}"><code>MixedHierarchyGames._construct_augmented_variables</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_construct_augmented_variables(ii, all_variables, K_syms, G)</code></pre><p>Build augmented variable list for player ii including follower K matrices.</p><p>For computing M and N that depend on follower policies, we need to include symbolic K matrices in the variable list.</p><p><strong>Arguments</strong></p><ul><li><code>ii::Int</code> - Player index</li><li><code>all_variables::Vector</code> - Base symbolic variables</li><li><code>K_syms::Dict</code> - Symbolic K matrices per player</li><li><code>G::SimpleDiGraph</code> - Hierarchy graph</li></ul><p><strong>Returns</strong></p><ul><li><code>augmented::Vector</code> - Variables including follower K matrix entries</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L130-L146">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._extract_joint_strategy-Tuple{AbstractVector, Vector{Int64}, Int64, Int64}"><a class="docstring-binding" href="#MixedHierarchyGames._extract_joint_strategy-Tuple{AbstractVector, Vector{Int64}, Int64, Int64}"><code>MixedHierarchyGames._extract_joint_strategy</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_extract_joint_strategy(sol, primal_dims, state_dim, control_dim)</code></pre><p>Extract per-player trajectories from solution vector and build JointStrategy. Shared helper used by both QPSolver and NonlinearSolver.</p><p>The solution vector may contain dual variables (λ, μ) after the primal variables. Only the first <code>sum(primal_dims)</code> elements are used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L5-L13">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._run_qp_solver-Tuple{Graphs.SimpleGraphs.SimpleDiGraph, Dict, Vector, Vector{Int64}, Dict, Dict}"><a class="docstring-binding" href="#MixedHierarchyGames._run_qp_solver-Tuple{Graphs.SimpleGraphs.SimpleDiGraph, Dict, Vector, Vector{Int64}, Dict, Dict}"><code>MixedHierarchyGames._run_qp_solver</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_run_qp_solver(
    hierarchy_graph::SimpleDiGraph,
    Js::Dict,
    gs::Vector,
    primal_dims::Vector{Int},
    θs::Dict,
    parameter_values::Dict;
    solver::Symbol = :linear,
    verbose::Bool = false
)</code></pre><p>Internal QP solver that orchestrates KKT construction and solving.</p><p>Note: This is an internal function. Users should prefer <code>QPSolver</code> + <code>solve()</code> for better performance (the MCP is cached in QPSolver.precomputed.parametric_mcp). This function rebuilds the MCP on every call, which is inefficient for repeated solves.</p><p><strong>Arguments</strong></p><ul><li><code>hierarchy_graph::SimpleDiGraph</code> - Hierarchy graph</li><li><code>Js::Dict</code> - Cost functions per player: Js<a href="zs...; θ">i</a> → scalar</li><li><code>gs::Vector</code> - Constraint functions per player: gs<a href="z">i</a> → Vector</li><li><code>primal_dims::Vector{Int}</code> - Primal variable dimension per player</li><li><code>θs::Dict</code> - Symbolic parameter variables per player</li><li><code>parameter_values::Dict</code> - Numerical parameter values per player</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>solver::Symbol=:linear</code> - Solver to use: <code>:linear</code> (direct) or <code>:path</code> (MCP)</li><li><code>verbose::Bool=false</code> - Print debug info</li></ul><p><strong>Returns</strong></p><p>Named tuple containing:</p><ul><li><code>sol::Vector</code> - Solution vector</li><li><code>status</code> - Solver status</li><li><code>info</code> - Additional solver info</li><li><code>vars</code> - Problem variables (zs, λs, μs, etc.)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/qp_kkt.jl#L246-L282">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._solve_K-Tuple{Matrix{Float64}, Matrix{Float64}, Int64}"><a class="docstring-binding" href="#MixedHierarchyGames._solve_K-Tuple{Matrix{Float64}, Matrix{Float64}, Int64}"><code>MixedHierarchyGames._solve_K</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_solve_K(M, N, player_idx; use_sparse=false)</code></pre><p>Solve <code>K = M \ N</code> with protection against singular or ill-conditioned M matrices.</p><p>When <code>use_sparse=true</code>, converts M to sparse format before solving, which can be beneficial for large M matrices (&gt;100 rows) with structural sparsity from the KKT system.</p><p>Returns a NaN-filled matrix (same size as expected K) if M is singular or severely ill-conditioned, with a warning.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/nonlinear_kkt.jl#L655-L665">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._validate_constraint_functions-Tuple{Vector, Dict}"><a class="docstring-binding" href="#MixedHierarchyGames._validate_constraint_functions-Tuple{Vector, Dict}"><code>MixedHierarchyGames._validate_constraint_functions</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_validate_constraint_functions(gs::Vector, zs::Dict)</code></pre><p>Validate that constraint functions have correct signatures, return Vectors, and only depend on the player&#39;s own decision variables (decoupled constraints).</p><p>Called during problem setup to catch errors early with clear messages.</p><p><strong>Arguments</strong></p><ul><li><code>gs::Vector</code> - Constraint functions per player: gs<a href="z">i</a> → Vector</li><li><code>zs::Dict</code> - Decision variables per player (used to test function signatures)</li></ul><p><strong>Throws</strong></p><ul><li><code>ArgumentError</code> if gs[i] has wrong signature, doesn&#39;t return AbstractVector, or contains variables from other players (coupled constraint)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/problem_setup.jl#L108-L123">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._validate_parameter_values-Tuple{Dict, Dict}"><a class="docstring-binding" href="#MixedHierarchyGames._validate_parameter_values-Tuple{Dict, Dict}"><code>MixedHierarchyGames._validate_parameter_values</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_validate_parameter_values(parameter_values::Dict, θs::Dict)</code></pre><p>Validate parameter_values against expected θs structure. Throws ArgumentError on mismatch.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L647-L651">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._validate_solver_inputs-Tuple{Graphs.SimpleGraphs.SimpleDiGraph, Dict, Vector, Vector{Int64}, Dict}"><a class="docstring-binding" href="#MixedHierarchyGames._validate_solver_inputs-Tuple{Graphs.SimpleGraphs.SimpleDiGraph, Dict, Vector, Vector{Int64}, Dict}"><code>MixedHierarchyGames._validate_solver_inputs</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_validate_solver_inputs(hierarchy_graph, Js, gs, primal_dims, θs)</code></pre><p>Validate inputs for solver constructors. Throws ArgumentError on invalid input. Used by both QPSolver and NonlinearSolver.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/types.jl#L93-L98">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames._verify_linear_system-Tuple{Any, Int64, Dict}"><a class="docstring-binding" href="#MixedHierarchyGames._verify_linear_system-Tuple{Any, Int64, Dict}"><code>MixedHierarchyGames._verify_linear_system</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">_verify_linear_system(mcp, n::Int, θs::Dict)</code></pre><p>Verify that the KKT system is affine (constant Jacobian) as required for QP/LQ games.</p><p>QPSolver assumes the KKT system F(z) = 0 is affine in z, i.e., F(z) = Jz + b where J is constant. This allows direct linear solve: z = -J⁻¹b. If the system is nonlinear, the linear solve will produce incorrect results.</p><p>This check evaluates the Jacobian at two random points during construction. If they differ, a warning is issued. The check runs once at construction time, not at solve time.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/types.jl#L183-L194">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.flatten_trajectory-Union{Tuple{T}, Tuple{Array{Vector{T}, 1}, Array{Vector{T}, 1}}} where T"><a class="docstring-binding" href="#MixedHierarchyGames.flatten_trajectory-Union{Tuple{T}, Tuple{Array{Vector{T}, 1}, Array{Vector{T}, 1}}} where T"><code>MixedHierarchyGames.flatten_trajectory</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">flatten_trajectory(xs::Vector{Vector{T}}, us::Vector{Vector{T}}) where T</code></pre><p>Flatten state and control trajectories into a single vector.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L302-L306">source</a></section></details></article><article><details class="docstring" open="true"><summary id="MixedHierarchyGames.ordered_player_indices-Tuple{Dict}"><a class="docstring-binding" href="#MixedHierarchyGames.ordered_player_indices-Tuple{Dict}"><code>MixedHierarchyGames.ordered_player_indices</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">ordered_player_indices(d::Dict)</code></pre><p>Return the keys of <code>d</code> as a sorted vector, providing a canonical player ordering.</p><p>This is a convenience wrapper around <code>sort(collect(keys(d)))</code> used throughout the codebase to iterate over player-indexed dictionaries in a deterministic order.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/utils.jl#L81-L88">source</a></section></details></article><article><details class="docstring" open="true"><summary id="TrajectoryGamesBase.solve_trajectory_game!-Tuple{NonlinearSolver, HierarchyGame, Any}"><a class="docstring-binding" href="#TrajectoryGamesBase.solve_trajectory_game!-Tuple{NonlinearSolver, HierarchyGame, Any}"><code>TrajectoryGamesBase.solve_trajectory_game!</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">TrajectoryGamesBase.solve_trajectory_game!(
    solver::NonlinearSolver,
    game::HierarchyGame,
    initial_state;
    kwargs...
)</code></pre><p>Solve a nonlinear hierarchy game.</p><p><strong>Arguments</strong></p><ul><li><code>solver::NonlinearSolver</code> - The nonlinear solver instance</li><li><code>game::HierarchyGame</code> - The hierarchy game to solve</li><li><code>initial_state</code> - Initial state per player (Dict{Int, Vector} or Vector of Vectors)</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>initial_guess::Union{Nothing, Vector}=nothing</code> - Warm start</li><li><code>verbose::Bool=false</code> - Print iteration info</li></ul><p><strong>Returns</strong></p><ul><li><code>JointStrategy</code> over <code>OpenLoopStrategy</code>s for each player</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L317-L338">source</a></section></details></article><article><details class="docstring" open="true"><summary id="TrajectoryGamesBase.solve_trajectory_game!-Tuple{QPSolver, HierarchyGame, Any}"><a class="docstring-binding" href="#TrajectoryGamesBase.solve_trajectory_game!-Tuple{QPSolver, HierarchyGame, Any}"><code>TrajectoryGamesBase.solve_trajectory_game!</code></a> — <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">TrajectoryGamesBase.solve_trajectory_game!(
    solver::QPSolver,
    game::HierarchyGame,
    initial_state;
    kwargs...
)</code></pre><p>Solve a QP (linear-quadratic) hierarchy game.</p><p><strong>Arguments</strong></p><ul><li><code>solver::QPSolver</code> - The QP solver instance</li><li><code>game::HierarchyGame</code> - The hierarchy game to solve</li><li><code>initial_state</code> - Initial state per player (Dict{Int, Vector} or Vector of Vectors)</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>verbose::Bool=false</code> - Print debug info</li></ul><p><strong>Returns</strong></p><ul><li><code>JointStrategy</code> containing <code>OpenLoopStrategy</code> for each player</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CLeARoboticsLab/MixedHierarchyGames.jl/blob/c946ea1e6399c86e4f536d13d0805deebfaa3766/src/solve.jl#L134-L154">source</a></section></details></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 11 February 2026 12:16">Wednesday 11 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
